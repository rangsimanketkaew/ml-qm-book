% LaTeX source for ``การเรียนรู้ของเครื่องสำหรับเคมีควอนตัม (Machine Learning for Quantum Chemistry)''
% Copyright (c) 2022 รังสิมันต์ เกษแก้ว (Rangsiman Ketkaew).

% License: Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)
% https://creativecommons.org/licenses/by-nc-nd/4.0/

\chapter{ลักษณะเด่นของอะตอมและโมเลกุล}
\label{ch:feature}

ลักษณะเด่น (Feature) คือคุณลักษณะที่มีความพิเศษและบ่งบอกความเฉพาะตัวของอะตอมหรือโมเลกุลนั้น ๆ ซึ่งอาจจะเรียกว่าเป็นคุณลักษณะแบบพิเศษก็ได้ 
(Special Attributes) นอกจากนี้เราสามารถตีความได้ว่า Feature นั้นจริง ๆ แล้วก็คือเป็นตัวแทนของสิ่งที่เราสนใจอีกด้วย ซึ่งในบริบททางเคมีนั้น
สิ่งที่เป็นคัสแทนของโมเลกุลนั้นเราเรียกว่า Molecular Representation (จริง ๆ แล้ว Feature กับ Representation ก็ไม่ได้มีความหมายเหมือนกันเสียทีเดียว
ขึ้นอยู่กับประเภทของข้อมูลที่ใช้เป็น Feature แต่ผู้เขียนจะขออนุญาตใช้ Representation เพราะว่าให้ความหมายที่สื่อการเป็นตัวแทนของโมเลกุลที่เราสนใจได้ดีกว่า)\cite{stepisnik2021}

คำถามที่ตามมาก็คือแล้ว Molecular Representation มีความสำคัญมากไหม และมีความสำคัญอย่างไร คำตอบก็คือมีความสำคัญและสำคัญมากด้วย 
อาจจะกล่าวได้ว่าสำคัญที่สุดเลยก็ว่าได้ เพราะ Representation ก็คือ Input ที่เรานำมาใช้สร้าง Model นั่นเอง ดังนั้นมันจึงเป็นปัจจัยหลักที่กำหนดประสิทธิภาพของ Model นั่นเอง 

เนื่องจากว่ามนุษย์สามารถแยกแยะโมเลกุลแต่ละตัวออกจากกันได้ แต่ว่าคอมพิวเตอร์ไม่สามารถทำได้ เพราะว่ามันเข้าใจข้อมูลที่เป็นแบบดิจิตอลในภาษาเครื่องจักรเท่านั้น 
(Machine Language) ดังนั้นเราจึงต้องมีการใช้ Representation เพื่ออธิบายโมเลกุลในรูปแบบของค่า Parameter ที่คอมพิวเตอร์สามารถเข้าใจได้ 
เช่น แปลงโมเลกุลเป็นเวกเตอร์ของตัวเลข สำหรับการอธิบายโมเลกุลแบบง่าย ๆ นั้นสามารถทำได้โดยใช้ Representation เพื่อมาอธิบายข้อมูลเชิงโครงสร้าง 
(Structural Properties) ซึ่งสามารถใช้ข้อมูลทางเคมีทั่วไปได้ ยกตัวอย่างเช่น รูปร่างของโมเลกุล, จำนวนหมู่ฟังก์ชัน, ชนิดของพันธะระหว่างอะตอมคาร์บอน, 
และจำนวนวงเบนซีน ซึ่งข้อมูลเหล่านี้เราสามารถคำนวณออกมาได้ง่าย ๆ ไม่มีความซับซ้อนอะไร แต่ปัญหาคือ Representation ที่เป็น Structure-based 
นั้นมีข้อมูลที่น้อยเกินไป จึงทำให้ไม่สามารถถูกนำมาใช้เป็น Input สำหรับการสร้าง Model เพื่อทำนายคุณสมบัติหรือ Parameter ทางเคมีที่ซับซ้อนหรือละเอียดกว่าได้ 
เช่น พลังงานพันธะ (Bond Energy), ค่าความถี่การสั่น (Vibration), ไดโพลโมเมนต์ (Dipole Moment), ฯลฯ นั่นก็เพราะว่า Input ของเรามันเป็น 
Representation ที่ไม่มี Correlation กับ Output ที่เราต้องการทำนายโดยตรง

ดังนั้นถ้าหากเราต้องการที่จะทำนาย Output ที่มีความละเอียดอยู่ในระดับอะตอมหรือเชิงอิเล็กทรอนิกส์ เราควรจะใช้ Representation ที่อยู่ในระดับเดียวกัน 
และ Representation Input เหล่านี้ควรจะต้องเก็บข้อมูลทางควอนตัมเคมีและฟิสิกส์ไว้ด้วย โดยการพัฒนา Representation โดยใช้องค์ความรู้ทางฟิสิกส์
(Physics-inspired Representation) ก็เป็นหนึ่งในหัวข้องานวิจัยที่กำลังมาแรงในขณะนี้ ข้อมูลทางฟิสิกส์ที่เราเพิ่มเข้าไปก็เปรียบเสมือนเป็นองค์ประกอบที่เพิ่มความถูกต้อง
(Correction) ให้กับ Representation ให้มากขึ้น เราใส่ระบุความเป็นสมมาตร (Symmetricity) ของโมเลกุลเข้าไปได้ เป็นต้น 

%--------------------------
\section{การแปลงข้อมูลเชิงโมเลกุล}
%--------------------------

โมเลกุลประกอบไปด้วยอะตอมหลายอะตอมมารวมกัน เราจึงเปรียบเทียบโมเลกุลเป็นประโยคหรือข้อความและเปนียบเทียบอะตอมเป็นคำแต่ละคำได้
ดังที่บอกไปในข้างต้นว่าการทำให้คอมพิวเตอร์เข้าใจความเชื่อมโยงระหว่างอะตอมในโมเลกุลนั้นต้องมีการกำหนดหรือเลือกใช้ Representation ที่เหมาะสม
โดยคุณสมบัติของ Representation ที่ดีนั้นไม่เพียงแต่จะต้องไม่ขึ้นกับการเคลื่อนที่เชิงการหมุน (Rotational Motion) และ การเคลื่อนที่เชิงเส้นด้วย 
(Transitional Motion) เท่านั้น แต่ควรจะต้องมีความเรียบง่ายและไม่ซับซ้อนหรือยุ่งยากเกินไปในการคำนวณเพื่อสร้าง Machine Code 
จากพิกัดตำแหน่งคาร์ทคีเชียน (Cartesian Coordinates)

%--------------------------
\section{ลักษณะเฉพาะเชิงโครงสร้างแบบทั่วไป}
%--------------------------

%--------------------------
\subsection{Internal Coordinates}
%--------------------------

Internal Coordinates หรือเรียกอย่างว่า $Z$ matrix (พิกัดภายในของโมเลกุล) เป็น Representation แบบที่ง่ายมาก 
อาจจะเรียกได้ว่าง่ายที่สุดเลยก็ว่าได้ ถูกใช้เป็น Descriptor มาอย่างยาวนาน โดยถูกใช้อย่างแพร่หลายในยุคแรก ๆ ของการเรียนรู้ของเครื่องสำหรับเคมี
Internal Coordinates สามารถอธิบายได้ทั้งโมเลกุล โดยองค์ประกอบของ Representation อันนี้มีความยาวพันธะระหว่างอะตอม (Bond Distance) 
มุมพันธะ (Bond Angle) และมุมบิดเบี้ยว (Dihedral Angle หรือ Torsion) ซึ่งจำนวนของอะตอมที่ถูกเลือกมาคำนวณ Internal Coordinates 
นั้นมักจะเป็นอะตอมที่เรียงกันอยู่หรืออยู่ใกล้กัน อย่างไรก็ตาม เราสามารถคำนวณหา Internal Coordinates ของโมเลกุลได้โดยพิจารณาอะตอมทุก ๆ คู่
หรือทุกความเป็นไปได้ทั้งหมดภายในโมเลกุล

%--------------------------
\subsection{Geometric Descriptors}
%--------------------------

Geometric Descriptors (ลักษณะเฉพาะเชิงเรขาคณิต) เป็น Descriptor (จะเรียกแทนด้วย Representation ก็ได้) ที่อ้างอิงกับข้อมูลตำแหน่งของอะตอมในโมเลกุล
โดยมักจะเชื่อมโยงกับ Representation แบบที่เป็นสัญลักษณ์หรือ Symbolic เช่น SMILES ซึ่ง Geometric Descriptors ก็สามารถแบ่งออกเป็นได้หลาย Descriptor 
ซึ่งก็รวมไปถึง $Z$ matrix, Coordination Number, Adjacency Matrix อย่างไรก็ตาม Representation ในกลุ่มนี้มักจะให้ผลการทำนายด้วย ML ไม่ค่อยดีนัก
นั่นก็เพราะว่าความสามารถในการกักเก็บข้อมูลเชิงอิเล็กทรอนิกส์นั้นน้อยมากเมื่อเทียบกับ Representation ประเภทที่เป็นแบบเชิงอะตอมหรือ Atom-wise Descriptor 
และยังมีโมเลกุลบางประเภทที่ Geometric Descriptors ไม่สามารถนำไปใช้ได้ อย่างเช่นโมเลกุลไอโซเมอร์ เช่น cis/trans สเตอริโอไอโซเมอร์
ดังนั้น Representation ประเภทนี้จึงไม่เป็นที่นิยมในการนำมาเทรน Model ML ในงานวิจัยทางด้านเคมีควอนตัม\cite{keith2021,musil2021}

%--------------------------
\section{ลักษณะเฉพาะเชิงโครงสร้างสำหรับโมเลกุล}
%--------------------------

Representation ประเภทนี้จะเป็นการอธิบายสภาพแวดล้อม (Environment) ของอันตรกิริยาระหว่างอะตอมทุกอะตอมในโมเลกุล โดยมักจะอยู่ในรูปของเมทริกซ์
เช่น เมทริกซ์ของส่วนกลับของระยะห่างระหว่างอะตอม (Inverse Distance Matrix) และเมทริกซ์คูลอมบ์ (Coulomb Matrix)

%--------------------------
\subsection{Inverse Distance Matrix}
%--------------------------

Inverse Distance Matrix (เมทริกซ์ของส่วนกลับของระยะห่างระหว่างอะตอม) เป็น Representation Matrix แบบที่ง่ายที่สุดและมีความหมายทางเคมีที่ชัดเจน
นั่นก็คือการใช้ส่วนกลับของระยะห่างระหว่างนิวเคลียสของอะตอมนั้นเป็นการจำลองเทอมของอันตรกิริยาระหว่างนิวเคลียสที่อยู่ใน Hamiltonian ของพลังงาน 
มีนิยามทางคณิตศาสตร์ตามสมการต่อไป

\begin{equation}
    D_{ij} = \frac{1}{||r_{i} - r_{j}||}
\end{equation}

เมื่อเราคำนวณออกมาเป็นเมทริกซ์ขนาด $i \times j$ แล้ว เราจะพบว่าสมาชิกของเมทริกซ์ในแนวทแยง (Diagonal Elements) นั้นจะไม่มีความหมาย 
ดังนั้นเราจึงสนใจเฉพาะสมาชิกนอกแนวทแยง (Off-diagonal Elements)

%--------------------------
\subsection{Coulomb Matrix}
%--------------------------

Coulomb Matrix (เมทริกซ์คูลอมบ์) เป็น Representation ที่ถูกเสนอครั้งแรกในปี ค.ศ. 2012 โดย Matthias Rupp และทีมวิจัย\citeauthor{rupp2012} 
โดยได้ถูกนำมาใช้อย่างแพร่หลายในงานวิจัยทางด้าน ML นั่นก็เพราะว่าไม่มีความสิ้นเปลืองในการคำนวณและให้ความแม่นยำในการทำนายค่าพลังงานของโมเลกุลสูง 
ซึ่ง Coulomb Matrix นั้นถูกพัฒนาขึ้นมาโดยมีพื้นฐานมาจาก Inverse Distance Matrix นั่นเอง โดยแก้ปัญหาสองส่วนดังนี้

\begin{enumerate}
    \item มีการกำหนดเงื่อนไขในการคำนวณสมาชิกโดยกำหนดค่าของสมาชิกในแนวทแยง
    \item รวมประจุของอะตอมเข้าไปด้วย ซึ่งเป็น Parameter สำคัญในการพัฒนา Force Field สำหรับการจำลองพลวัตเชิงโมเลกุล (MD Simulation)
\end{enumerate}

สมการสำหรับการคำนวณสมาชิกของ Coulomb Matrix คือ

\begin{equation}
    \label{eq:cm}
    C_{ij} =
    \begin{cases}
     & 0.5 Z_i^{2.4} \text{ if } i = j \\ 
     & \frac{Z_i Z_j}{R_{ij}} \text{ if } i \neq j
    \end{cases}
\end{equation}

จากสมการที่ \ref{eq:cm} จะเห็นได้ว่าเราได้แบ่งเงื่อนไขในการคำนวณสมาชิกของ Coulomb Matrix ออกเป็นสองเงื่อนไข สำหรับกรณีคู่อะตอมเหมือนกันและต่างกัน
โดยที่พลังงานศักย์เชิงไฟฟ้าสถิตย์ของอะตอมแต่ละคู่นั้นจะถูกเข้ามาด้วย (ผ่านเทอมของประจุ) นั่นก็คือสมาชิกนอกแนวทแยงจะแสดงถึงแรงผลักคูลอมบ์ระหว่างอะตอม
ในขณะที่สมาชิกในแนวทแยงจะเป็นการเทียบเคียงค่าเลขอะตอมกับพลังงานของอะตอมในกรณีที่ไม่ได้มีอันตรกิริยากับอะตอมตัวอื่น

ถึงแม้ว่า Coulomb Matrix จะเป็น Representation ที่ไม่ขึ้นกับการเลื่อนตำแหน่งและการหมุนของโมเลกุล แต่ว่าก็ยังขึ้นอยู่กับการเปลี่ยนตำแหน่งหรือการสลับที่กันของอะตอม
เพื่อแก้ปัญหาดังกล่าว ได้มีนักวิจัยได้นำเสนอ Representation ตัวใหม่อีกหลายตัวที่เปรียบเสมือนเป็น Coulomb Matrix ที่ถูกปรับปรุงให้ดีขึ้น เช่น  
Permutation-Invariant Polynomials (PIP)\cite{braams2009}, Randomly Sorted Coulomb Matrices (RSCM)\cite{hansen2013}, 
Bag of Bonds (BoB)\cite{hansen2013}, และ Permutation Invariant Vectors (PIV)\cite{gallet2013} 
โดย Representation เหล่านี้ได้แก้ปัญหาเกี่ยวลำดับของอะตอม ทำให้ Representation ประเภทนี้มีประสิทธิภาพมากขึ้นและลด Bias ที่อาจจะเกิดขึ้นด้วย

%--------------------------
\section{ลักษณะเฉพาะเชิงอิเล็กทรอนิกส์สำหรับอะตอม}
%--------------------------

นอกเหนือจาก Representation ที่เรานำมาอธิบายโมเลกุลแบบทั้งโมเลกุล ยังมี Representation แบบอื่นที่มีความซับซ้อนที่ถูกพัฒนาขึ้นมาเพื่ออธิบาย
Environment ของโมเลกุลในระดับอะตอมแบบเฉพาะเจาะจง ซึ่ง Representation แบบนี้จะเป็นการรวมความสำคัญของกฎทางฟิสิกส์และเคมีแบบต่าง ๆ เข้ามาไว้
จึงทำให้ Representation ประเภทนี้มีความสามารถในการที่จะอธิบายโครงสร้างเชิงอิเล็กทรอนิกส์ของโมเลกุลได้ดีมาก ๆ โดยเฉพาะการทำนายคุณสมบัติในระดับอะตอม
โดยในปัจจุบันก็ได้มีการพัฒนา Representation ประเภท Atom-wise อย่างมากมาย ดังนั้นผู้เขียนจะขออธิบายเฉพาะ Representation ที่มีความโดดเด่นและเป็นที่นิยมเท่านั้น

%--------------------------
\subsection{Smooth Overlap of Atomic Positions}
%--------------------------

Representation ที่เป็นประเภทเชิงอิเล็กทรอนิกส์สำหรับอะตอมอันแรกที่จะพูดถึงก็คือ Smooth Overlap of Atomic Positions (SOAP) 
ซึ่งเป็นตัวที่โด่งดังมากแล้วก็มีการนำมาใช้อย่างแพ่หลาย เรียกได้ว่านักวิจัยเคมีควอนตัมและปัญญาประดิษฐ์ต่างก็รู้จัก SOAP กันเป็นอย่างดี
โดยบทความงานวิจัยของ SOAP ได้ถูกตีพิมพ์ครั้งแรกในปี ค.ศ. 2013 ซึ่งไอเดียของ SOAP ก็คือจะเป็นการนำข้อมูลโครงสร้างของอะตอมมาเข้ารหัส (Encoding) 
ไว้ได้โดยได้รวมสภาพแวดล้อมทางเคมีโดยการใช้ความหนาแน่นเชิงอะตอมแบบเกาส์เซียน (Gaussian Smeared Atomic Density) 
ซึ่ง Atomic Density ที่ว่านี้ก็ถูกคำนวณมาจากฟังก์ชันพื้นฐานเชิงรัศมี (Radial Basis Function, $g_{n}(r)$) และฟังก์ชันฮาร์โมนิคเชิงทรงกลม 
(Real Spherical Harmonic Functions, $Y_{lm}(\theta, \phi)$)\cite{bartok2013,de2016}
โดย SOAP นั้นเหมาะสำหรับนำมาใช้ทำนายคุณสมบัติของโมเลกุลในระดับอะตอม (Local Properties) อย่างเช่นแรงเชิงอะตอม (Atomic Force) หรือ Chemical Shift

การคำนวณ SOAP นั้นจริง ๆ แล้วทำได้ผ่านการคำนวณ Kernel ของ Atomic Environment 2 อันเข้าด้วยกัน ($\mathcal{X}$ and $\mathcal{X}'$)
ซึ่งเขียนออกมาได้ในรูปของ Polynomial Kernel ($K^\mathrm{SOAP}$ ของ Parameter ที่ชื่อว่า Partial Power Spectra 
($\mathbf{p}$ และ $\mathbf{p}'$)\footnote{ผู้เขียนไม่แน่ใจว่าจะแปลเป็นภาษาไทยอย่างไรดี} 

โดยสมการที่เรานำมาใช้ในการคำนวณ SOAP นั้นคือ

\begin{equation}
    K^\mathrm{SOAP}(\mathbf{p}, \mathbf{p'}) = \left( \frac{\mathbf{p} \cdot \mathbf{p'}}{\sqrt{\mathbf{p} 
    \cdot \mathbf{p}~\mathbf{p'} \cdot \mathbf{p'}}}\right)^{\xi}
\end{equation}

\noindent โดยที่กำหนดให้ $\xi$ เป็นจำนวนเต็มบวกและสมาชิกของเวกเตอร์ $\mathbf{p}$ มีนิยามคือ 

\begin{equation}
    p^{Z_1 Z_2}_{n n' l} = \pi \sqrt{\frac{8}{2l+1}}\sum_m {c^{Z_1}_{n l m}}^{\dagger} c^{Z_2}_{n' l m}
\end{equation}

\noindent โดยที่ $n$ และ $n'$ เป็นดัชนีสำหรับ Radial Basis Function ซึ่งมีค่าได้สูงสุดถึง $n_{max}$, $l$ เป็นดีกรีเชิงมุม (Angular Degree)
ของ Spherical Harmonics ซึ่งมีค่าได้สูงสุดถึง $l_{max}$, $m$ เป็นจำนวนเต็มที่สอดคล้องกับเงื่อนไขคือ $\abs{m} \leq l$, 
และ $Z_{1}$ และ $Z_{2}$ เป็นสปีชีส์เชิงอะตอม (Atomic Species) นากจากนี้ค่าสัมประสิทธิ์ $c^{Z}_{n'lm}$ และ ${c^{Z}_{nlm}}^{\dagger}$ 
ถูกนิยามให้เป็นผลคูณภายในของ Spherical Harmonic Functions กับความหนาแน่นเชิงอะตอมแบบเกาส์เซียน ($\rho^Z$) และคอนจูเกตเชิงซ้อน 
(Complex Conjugate) ตามลำดับ\cite{de2016} เนื่องจากว่ารายละเอียดในการพิสูจน์สมการ Kernel ของ SOAP นั้นมีความซับซ้อนมาก
ผู้อ่านสามารถศึกษาเพิ่มเติมได้ที่บทความต้นฉบับ ส่วนรายละเอียดในการคำนวณหรือการเขียนโปรแกรมสำหรับคำนวณ SOAP นั้นสามารถดูได้ที่
\url{https://singroup.github.io/dscribe/latest/tutorials/descriptors/soap.html}

%--------------------------
\subsection{Atom-centered Symmetry Functions}
%--------------------------

Atom-centered Symmetry Functions (ACSF) generalize the output of multiple two- and three-body functions 
to estimate the local electronic environment near atoms using a fingerprint method that can be customized 
to detect specific structural features for symmetric functions.\cite{behler2011} Radial symmetric functions 
for the central atom $i$ with neighboring atom $j$ are given as follows:

\begin{equation}
    G^{radial}_{i} = \sum^{N_{atom}}_{j \neq i} e^{\eta (\boldsymbol{r}_{ij} - \mu)^{2}} f_{c}(\boldsymbol{r}_{ij})
\end{equation}

\noindent where $\eta$ and $\mu$ are the parameters controlling the width and the position of 
the Gaussian function. $f_{c}$ is a cutoff function that selects the relevant regions close to 
the central nucleus to be encoded into the ACSF and $\boldsymbol{r}_{ij}$ is the displacement between 
the atoms $i$ and $j$. Angular symmetric functions have been defined.\cite{behler2011} 
Moreover, an input required to ACSFs is fine-tuning of internal parameters that can be properly used 
to define the Gaussian function. A similar representation to ACSFs is the Spectrum of London and 
Axilrod-Teller-Muto (SLATM), which has been recently used in the literature, but mostly for 
kernel ridge regression (KRR) models.\cite{faber2018} Polynomial functions of the inverse of 
the interatomic distances have also been suggested but are not discussed in this review.\cite{musil2021}

%--------------------------
\subsection{Gaussian-type Orbital-based Density Vectors}
%--------------------------

Gaussian-type Orbital (GTO)-based Density Vector is a descriptor function alternative to 
the ACSF and symmetric polynomial function.\cite{kwac2021} The GTO-based density vector is given by

\begin{equation}
    \rho^{i}_{L,\alpha,r_{s}} = \sum^{l_{x}+l_{y}+l_{z} = L}_{l_{x},l_{y},l_{z}} 
    \frac{L!}{l_{x}!l_{y}!l_{z}!} \left ( \sum^{n_{type}}_{t=1} c_{t} \sum^{N^{t}_{atom}}_{j=1} 
    \phi^{\alpha,r_{s}}_{l_{x}l_{y}l_{z}} (\boldsymbol{r}_{ij}) \right )
\end{equation}

\noindent where $l_{x}+l_{y}+l_{z} = L$ specifies the orbital angular momentum, $n_{type}$ is the atomic type 
in the molecule under study, $c_{t}$ is the type-dependent weight, $N^{t}_{atom}$ is the number of atoms of 
the type $t$, and $\phi^{\alpha,r_{s}}_{l_{x}l_{y}l_{z}} (r_{ij})$ is the Gaussian orbital centered at 
each atom with the parameters $\alpha$ and $r_{s}$ which determine the radial distributions of orbital functions, 
given as

\begin{equation}
    \phi^{\alpha,r_{s}}_{l_{x}l_{y}l_{z}} (\boldsymbol{r}_{ij}) = x^{l_{x}}y^{l_{y}}z^{l_{z}} e^{-\alpha 
    |r-r_{s}|^{2}}
\end{equation}

\noindent where $\boldsymbol{r}_{ij} = (x,y,z)$ indicates the vector from nuclei $i$ to nuclei $j$ and $r$ 
is the magnitude of $\boldsymbol{r}_{ij}$. GTOs with $L=0,1$ are usually considered for constructing 
the density vectors for small organic molecules containing light atoms such as C, H, O, and N.\cite{kwac2021}
